@{
	ViewData["Title"] = "Checkout Details";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
	/* General Page Styles */
	.page-checkout {
		background-color: #f8f9fa;
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
	}

	.price-highlight {
		color: #dc3545; 
		font-weight: 500; 
	}

	.focused-checkout-logo img {
		max-width: 250px;
		height: auto;
	}

	/* Breadcrumbs */
	.checkout-breadcrumbs {
		font-size: 0.9rem;
		color: #6c757d;
		margin-bottom: 2rem;
	}
	.checkout-breadcrumbs a {
		color: #0d6efd;
		text-decoration: none;
	}
	.checkout-breadcrumbs a.current {
		color: #212529;
		font-weight: 600;
	}
	.checkout-breadcrumbs .divider {
		margin: 0 0.75em;
		color: #adb5bd;
	}

	/* Section Titles */
	.checkout-section-title {
		font-size: 1.5rem;
		font-weight: 500;
		margin-bottom: 1.5rem;
		padding-bottom: 0.75rem;
		border-bottom: 1px solid #dee2e6;
	}

	/* Form Fields Styling */
	.form-row-checkout {
		margin-bottom: 1.25rem;
	}
	.form-row-checkout label:not(.form-check-label) { /* Không áp dụng cho label của checkbox/radio bên trong form-check */
		font-weight: 500;
		margin-bottom: .35rem;
		display: block;
		font-size: 0.9rem;
		color: #495057;
	}
	.form-row-checkout label .required {
		color: #dc3545;
		margin-left: .2rem;
	}
	.form-control, .form-select {
		border-radius: .25rem;
		border: 1px solid #ced4da;
		padding: .5rem .75rem;
		font-size: 0.95rem;
	}
	.form-control:focus, .form-select:focus {
		border-color: #86b7fe;
		box-shadow: 0 0 0 .25rem rgba(13, 110, 253, .25);
	}
	/* Căn chỉnh cho radio/checkbox và label */
	.form-check.d-flex.align-items-center .form-check-input {
		margin-top: 0; /* Reset margin top nếu có */
	}
	.form-check.d-flex.align-items-center .form-check-label {
		margin-bottom: 0; /* Reset margin bottom */
	}


	/* Order Review Section */
	.order-review-box {
		background-color: #ffffff;
		border: 1px solid #dee2e6;
		border-radius: .375rem;
		padding: 1.5rem;
	}

	/* Target vào table bên trong div#order_review hoặc table.shop_table */
	#order_review table.shop_table { 
		width: 100%;
		margin-bottom: 1rem;
		font-size: 0.9rem;
		table-layout: fixed;
	}

	#order_review table.shop_table th,
	#order_review table.shop_table td {
		padding: 0.75rem 0.5rem;
		border-bottom: 1px solid #e9ecef;
		vertical-align: middle;
		word-wrap: break-word;
	}

	#order_review table.shop_table thead th {
		border-bottom-width: 2px;
		border-color: #adb5bd;
		color: #495057;
		font-weight: 600;
		text-transform: uppercase;
		font-size: 0.85rem;
	}

	/* --- ĐIỀU CHỈNH ĐỘ RỘNG CỘT --- */
	#order_review table.shop_table th.product-name,
	#order_review table.shop_table td.product-name {
		width: 55%;
		text-align: left;
	}

	#order_review table.shop_table th.product-total, /* Tiêu đề cột tạm tính (nếu có) */
	#order_review table.shop_table td.product-total { /* Giá trị tạm tính của từng sản phẩm */
		width: 45%;
		text-align: right;
	}
	
	/* Style cho tfoot - phần tổng kết */
	#order_review table.shop_table tfoot th {
		font-weight: 600;
		text-align: left;
		width: 65%; /* Điều chỉnh lại cho phù hợp, ví dụ: 65% */
		border-top: 1px solid #dee2e6; /* Thêm đường kẻ trên cho các hàng tfoot */
	}
	#order_review table.shop_table tfoot td {
		text-align: right;
		font-weight: 500;
		width: 35%; /* Điều chỉnh lại cho phù hợp, ví dụ: 35% */
		border-top: 1px solid #dee2e6;
	}

	/* Style cho tfoot - phần shipping */
	#order_review table.shop_table tfoot div.shipping-custom-layout {
	}
	#order_review table.shop_table tfoot div.shipping-label {
		padding-right: 10px;
		font-weight: 600; 
		text-align: left;
	}
	#order_review table.shop_table tfoot div.shipping-options {
		text-align: left;
	}

	/* Riêng cho hàng Tổng cộng cuối cùng */
	#order_review table.shop_table tfoot tr.order-total th,
	#order_review table.shop_table tfoot tr.order-total td {
		font-size: 1.1rem;
		font-weight: bold;
		color: #212529;
		border-top: 2px solid #212529; /* Đường kẻ đậm hơn cho hàng tổng */
		padding-top: 0.75rem;
		padding-bottom: 0.75rem;
	}
	/* ----------------------------- */


	#order_review table.shop_table .product-name .product-quantity {
		color: #6c757d;
		font-size: 0.85em;
		display: block;
		margin-top: 2px;
	}
	/* Payment Methods */
	.payment_methods {
		list-style: none;
		padding-left: 0;
	}
	.payment_methods li {
		padding: 0.75rem;
		border: 1px solid #e9ecef;
		margin-bottom: 0.75rem;
		border-radius: .25rem;
	}
	/* Không cần style riêng cho .payment_methods li label và input nữa nếu dùng d-flex */
	.payment_box {
		background-color: #f8f9fa;
		padding: 0.75rem;
		margin-top: 0.75rem;
		border-radius: .25rem;
		font-size: 0.85rem;
		color: #495057;
		border-left: 3px solid #0d6efd;
	}
	.place-order-button {
		font-size: 1.1rem;
		font-weight: 500;
		padding: 0.75rem 1.5rem;
	}
	.coupon-toggle a {
		font-size: 0.9rem;
	}
	.checkout-coupon-form {
		border: 1px dashed #adb5bd;
		padding: 1rem;
		margin-bottom: 1.5rem;
		border-radius: .25rem;
	}
</style>

<div id="main" class="page-wrapper page-checkout py-4">

	<div class="focused-checkout-logo text-center mb-4">
		<a href="@Url.Action("Index", "Home")">
			<img width="250" src="@Url.Content("~/images/icons/logo.JPG")" alt="GCT Store">
		</a>
	</div>

	<div class="container">
		<div class="top-divider full-width border-bottom mb-4"></div>

		<div class="focused-checkout-header text-center pb-4">
			<nav class="breadcrumbs checkout-breadcrumbs h5">
				<a href="@Url.Action("Index", "Cart")">Giỏ hàng</a>
				<span class="divider"><i class="fas fa-chevron-right"></i></span>
				<a href="#" class="current">Chi tiết thanh toán</a>
				<span class="divider"><i class="fas fa-chevron-right"></i></span>
				<a href="#" class="no-click text-muted">Đơn hàng hoàn tất</a>
			</nav>
		</div>

		<div class="coupon-toggle mb-4 text-center">
			<div class="alert alert-info d-inline-block p-2" role="alert" style="font-size: 0.9rem;">
				Bạn có mã ưu đãi? <a href="#" class="alert-link fw-bold" id="showCouponForm">Ấn vào đây để nhập mã</a>
			</div>
		</div>
		<form class="checkout_coupon checkout-coupon-form mb-4" method="post" style="display:none;" id="checkoutCouponForm">
			<p class="form-row-checkout">Nhập mã giảm giá của bạn nếu có.</p>
			<div class="input-group">
				<input type="text" name="coupon_code" class="form-control" placeholder="Mã ưu đãi" id="coupon_code_checkout" value="">
				<button type="submit" class="btn btn-secondary" name="apply_coupon" value="Áp dụng">Áp dụng</button>
			</div>
		</form>

		<form name="checkout" method="post" class="checkout" asp-controller="Checkout" asp-action="PlaceOrder">
			@Html.AntiForgeryToken()
			<div class="row pt-0 ">
				<div class="col-lg-7 mb-4 mb-lg-0">
					<div id="customer_details">
						<div class="checkout-form-section">
							<h3 class="checkout-section-title">Thông tin thanh toán</h3>
							<div class="row">
								<div class="col-12 form-row-checkout">
									<label for="BillingFullName">Họ và tên <span class="required">*</span></label>
									<input type="text" class="form-control" name="BillingFullName" id="BillingFullName" placeholder="Nhập họ và tên" required>
								</div>
								<div class="col-md-6 form-row-checkout">
									<label for="BillingPhoneNumber">Số điện thoại <span class="required">*</span></label>
									<input type="tel" class="form-control" name="BillingPhoneNumber" id="BillingPhoneNumber" placeholder="Nhập số điện thoại" required>
								</div>
								<div class="col-md-6 form-row-checkout">
									<label for="BillingEmail">Địa chỉ email <span class="required">*</span></label>
									<input type="email" class="form-control" name="BillingEmail" id="BillingEmail" placeholder="Nhập địa chỉ Email" required>
								</div>
								<div class="col-md-4 form-row-checkout">
									<label for="BillingState">Tỉnh/Thành phố <span class="required">*</span></label>
									<select name="BillingState" id="BillingState" class="form-select" required>
										<option value="">Chọn tỉnh/thành...</option>
										<option value="HCM">Tp. Hồ Chí Minh</option>
										<option value="HN">Hà Nội</option>
									</select>
								</div>
								<div class="col-md-4 form-row-checkout">
									<label for="BillingCity">Quận huyện <span class="required">*</span></label>
									<select name="BillingCity" id="BillingCity" class="form-select" required>
										<option value="">Chọn quận/huyện...</option>
									</select>
								</div>
								<div class="col-md-4 form-row-checkout">
									<label for="BillingWard">Xã/Phường <span class="required">*</span></label>
									<select name="BillingWard" id="BillingWard" class="form-select" required>
										<option value="">Chọn xã/phường...</option>
									</select>
								</div>
								<div class="col-12 form-row-checkout">
									<label for="BillingAddress1">Địa chỉ (Số nhà, tên đường) <span class="required">*</span></label>
									<input type="text" class="form-control" name="BillingAddress1" id="BillingAddress1" placeholder="Ví dụ: 123 Đường ABC" required>
								</div>
							</div>
						</div>

						<div class="form-check my-4 d-flex align-items-center"> @* ÁP DỤNG FLEXBOX CHO CHECKBOX *@
							<input class="form-check-input me-2" type="checkbox" name="ShipToDifferentAddress" value="true" id="shipToDifferentAddressCheckbox">
							<label class="form-check-label mb-0" for="shipToDifferentAddressCheckbox">
								Giao hàng đến địa chỉ khác?
							</label>
						</div>

						<div class="shipping_address_fields checkout-form-section" style="display:none;">
							<h3 class="checkout-section-title">Thông tin giao hàng</h3>
							<div class="row">
								<p class="col-12"><em>(Các trường địa chỉ giao hàng sẽ tương tự như trên)</em></p>
							</div>
						</div>

						<div class="checkout-form-section mt-4">
							<div class="form-row-checkout">
								<label for="OrderNotes">Ghi chú đơn hàng (tuỳ chọn)</label>
								<textarea name="OrderNotes" class="form-control" id="OrderNotes" placeholder="Ghi chú về đơn hàng..." rows="3"></textarea>
							</div>
						</div>
					</div>
				</div>

				<div class="col-lg-5">
					<div class="order-review-box">
						<h3 class="checkout-section-title">Đơn hàng của bạn</h3>
						<div id="order_review">
							<table class="shop_table">
								<thead>
								<tr>
									<th class="product-name">Sản phẩm</th>
									<th class="product-total">Tạm tính</th>
								</tr>
								</thead>
								<tbody>
								<tr class="cart_item">
									<td class="product-name">Tên Sản Phẩm Mẫu A <strong class="product-quantity">× 2</strong></td>
									<td class="product-total"><span class="amount price-highlight">2,000,000<span class="currencySymbol">₫</span></span></td>
								</tr>
								<tr class="cart_item">
									<td class="product-name">Tên Sản Phẩm Mẫu B <strong class="product-quantity">× 1</strong></td>
									<td class="product-total"><span class="amount price-highlight">500,000<span class="currencySymbol">₫</span></span></td>
								</tr>
								</tbody>
								<tfoot>
								<tr class="cart-subtotal">
									<th>Tạm tính</th>
									<td><span class="amount price-highlight" id="checkoutSubtotal">2,500,000<span class="currencySymbol">₫</span></span></td>
								</tr>
								<tr> 
									<td colspan="2" style="padding: 0.75rem 0.5rem; border-bottom: 1px solid #e9ecef;">
										<div class="shipping-custom-layout d-flex align-items-start"> 
											<div class="shipping-label">Vận chuyển</div>
											<div class="shipping-options" > 
												<ul id="shipping_method_options_checkout" class="list-unstyled mb-0">
													<li class="mb-1">
														<div class="form-check d-flex align-items-left">
															<input type="radio" name="ShippingMethod" class="form-check-input me-2" id="shipping_pickup_checkout" value="pickup" checked>
															<label for="shipping_pickup_checkout" class="form-check-label mb-0">Đến nhận tại cửa hàng</label>
														</div>
													</li>
													<li class="mb-1">
														<div class="form-check d-flex align-items-left">
															<input type="radio" name="ShippingMethod" class="form-check-input me-2" id="shipping_standard_checkout" value="standard_25000">
															<label for="shipping_standard_checkout" class="form-check-label mb-0">Giao Hàng Tiêu Chuẩn: <span class="amount price-highlight">25,000<span class="currencySymbol">₫</span></span></label>
														</div>
													</li>
												</ul>
											</div>
										</div>
									</td>
								</tr>
								<tr class="order-total">
									<th>Tổng cộng</th>
									<td><strong><span class="amount price-highlight" id="checkoutTotal">2,525,000<span class="currencySymbol">₫</span></span></strong></td>
								</tr>
								</tfoot>
							</table>

							<div id="payment" class="mt-4">
								<ul class="payment_methods">
									<li class="payment_method_bacs">
										<div class="form-check d-flex align-items-center"> @* FLEXBOX *@
											<input id="payment_method_bacs_checkout" type="radio" class="form-check-input me-2" name="PaymentMethod" value="bacs" checked>
											<label for="payment_method_bacs_checkout" class="form-check-label mb-0">Chuyển khoản ngân hàng</label>
										</div>
										<div class="payment_box payment_method_bacs mt-2">
											<p>Thực hiện thanh toán vào tài khoản ngân hàng của chúng tôi. Vui lòng sử dụng Mã đơn hàng của bạn trong phần Nội dung thanh toán. Đơn hàng sẽ được giao sau khi tiền đã chuyển.</p>
										</div>
									</li>
									<li class="payment_method_cod mt-2">
										<div class="form-check d-flex align-items-center"> @* FLEXBOX *@
											<input id="payment_method_cod_checkout" type="radio" class="form-check-input me-2" name="PaymentMethod" value="cod">
											<label for="payment_method_cod_checkout" class="form-check-label mb-0">Trả tiền mặt khi nhận hàng (COD). Quý khách vui lòng có trước 50k</label>
										</div>
										<div class="payment_box payment_method_cod mt-2" style="display:none;">
											<p>Trả tiền mặt khi giao hàng.</p>
										</div>
									</li>
								</ul>
								<div class="form-row place-order mt-4">
									<button type="submit" class="btn btn-primary btn-lg w-100 place-order-button" id="place_order_button">Đặt hàng</button>
								</div>
							</div>
							<div class="checkout-privacy-policy-text mt-3 text-muted small">
								<p>Thông tin cá nhân của bạn sẽ được sử dụng để xử lý đơn hàng, tăng trải nghiệm sử dụng website, và cho các mục đích cụ thể khác đã được mô tả trong chính sách riêng tư.</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</form>
	</div>
</div>

@section Scripts {
	<script>
		$(document).ready(function() {
			// Toggle hiển thị địa chỉ giao hàng khác
			$('#shipToDifferentAddressCheckbox').change(function() {
				$('.shipping_address_fields').toggle(this.checked);
			}).trigger('change');

			// Toggle hiển thị payment_box khi chọn phương thức thanh toán
			$('input[name="PaymentMethod"]').change(function() {
				$('.payment_box').slideUp();
				if (this.checked) {
					$(this).closest('li').find('.payment_box').slideDown();
				}
			});
			$('input[name="PaymentMethod"]:checked').closest('li').find('.payment_box').show();

			// Toggle form mã giảm giá
			$('#showCouponForm').click(function(e) {
				e.preventDefault();
				$('#checkoutCouponForm').slideToggle();
			});

			$('input[name="ShippingMethod"]').change(function() {
				console.log('Shipping method changed to: ' + $(this).val());
				// TODO: Add logic to recalculate total based on shipping cost
			});
		});
	</script>
}